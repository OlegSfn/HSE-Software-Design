# Система анализа плагиата (Anti-Plagiat)

## Реализованный функционал

1. **Хранение файлов**
   - Загрузка, просмотр, скачивание и удаление файлов через `FilesController`
   - Хранение метаданных файлов в `FileMetadata`
   - Физическое хранение файлов на диске через `FileStorageService`

2. **Анализ плагиата**
   - Анализ файлов на наличие плагиата через `AnalysisController`
   - Хранение результатов анализа в `FileAnalysisResult`
   - Отслеживание "совпадений" в `SimilarityMatch`
   - Вычисление статистики по файлам

3. **API Gateway**
   - Маршрутизация запросов между микросервисами через APIGateway
   - Единая точка входа в приложение

## Применение микросервисной архитектуры

1. **Разделение на независимые сервисы**
   - **FileStoringService**: отвечает за загрузку, хранение и управление файлами
   - **FileAnalisysService**: отвечает за анализ файлов, сохранённых в **FileStoringService** и определение плагиата
   - **APIGateway**: обеспечивает маршрутизацию запросов между сервисами

2. **Изоляция данных**
   - Отдельная физическая база данных для каждого сервиса:
     - `postgres-filestoring`: хранит метаданные файлов для FileStoringService
     - `postgres-fileanalysis`: хранит результаты анализа для FileAnalisysService
   - Повышенная отказоустойчивость: при отказе одной БД второй сервис продолжает работу
   - Предотвращение прямого доступа к данным между сервисами, получение данных происходит через API другого сервиса

## Структура проекта

1. **FileStoringService**
   - `Controllers/FilesController.cs`: API для управления файлами
   - `Data/AppDbContext.cs`: контекст базы данных для хранения метаданных
   - `Models/FileMetadata.cs`: модель метаданных файла
   - `Services/FileStorageService.cs`: сервис для физического хранения файлов

2. **FileAnalisysService**
   - `Controllers/AnalysisController.cs`: API для анализа плагиата
   - `Data/AnalysisDbContext.cs`: контекст базы данных для результатов анализа
   - `Models/FileAnalysisResult.cs`: модель результатов анализа
   - `Models/SimilarityMatch.cs`: модель совпадений между файлами
   - `Services/FileAnalysisService.cs`: сервис для выполнения анализа

3. **APIGateway**
   - `Program.cs`: конфигурация API-шлюза и маршрутизации запросов

## Особенности реализации

1. **Проверка на антиплагиат**
    - Проверяются все файлы, отличные от загруженного
    - Если у файлов совпадают названия, то совпадение 100%
    - Если названия разные, то выбирается случайный процент плагиат от 0 до 60
    - Если процент плагиат хотя бы 30%, то в новом загруженном файле появляется указание на плагиат с уже существующим файлом

2. **Тестирование работы**
    - Запустить программу можно командой docker compose up --build в корневой директории проекта
    - Проверить работу можно зайдя на каждый из отдельных сервисов:
      - `http://localhost:7001/api/*`: API-шлюз, api/files/* для отправки запроса в FileStoringService и api/analysis/* для отправки запроса в FileAnalisysService
      - `http://localhost:7002/swagger/index.html`: API для управления файлами
      - `http://localhost:7003/swagger/index.html`: API для анализа плагиата